<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 4 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- Title -->
    <title>verdure</title>

    <!-- Favicon -->
    <link rel="icon" href="/static/alazea-gh-pages/img/core-img/favicon.ico">

    <!-- Core Stylesheet -->
    <link rel="stylesheet" href="/static/alazea-gh-pages/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.15.5/dist/sweetalert2.min.css">

</head>

<body>
    <!-- Preloader -->
    <div class="preloader d-flex align-items-center justify-content-center">
        <div class="preloader-circle"></div>
        <div class="preloader-img">
            <img src="/static/alazea-gh-pages/img/core-img/leaf.png" alt="">
        </div>
    </div>

    <!-- ##### Header Area Start ##### -->
    <header class="header-area">

        <!-- ***** Top Header Area ***** -->
        <div class="top-header-area">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="top-header-content d-flex align-items-center justify-content-between">
                            <!-- Top Header Content -->
                            <div class="top-header-meta">
                                <a href="#" data-toggle="tooltip" data-placement="bottom" title="verdure@gmail.com"><i class="fa fa-envelope-o" aria-hidden="true"></i> <span>Email: verdure@gmail.com</span></a>
                                <a href="#" data-toggle="tooltip" data-placement="bottom" title="+1 234 122 122"><i class="fa fa-phone" aria-hidden="true"></i> <span>Call Us: +1 234 122 122</span></a>
                            </div>

                            <!-- Top Header Content -->
                            <div class="top-header-meta d-flex">
                                <!-- Login -->
                                <div class="login">
                                {% if user.is_authenticated %}
                                    <a href="{% url 'usersignout' %}"><i class="fa fa-sign-out" aria-hidden="true"></i> <span>Logout</span></a>
                                {% else %}
                                    <a href="{% url 'signin' %}"><i class="fa fa-user" aria-hidden="true"></i> <span>Login</span></a>
                                {% endif %}
                                </div>
                                <!-- Cart -->
                                <div class="cart">
                                    <a href="{% url 'cart:carts' %}"><i class="fa fa-shopping-cart" aria-hidden="true"></i> <span>Cart <span class="cart-quantity">(1)</span></span></a>
                                </div>
                                <div class="login ml-5">
                                    {% if user.is_authenticated %}
                                        <a href="{% url 'userprofile' %}"><i class="fa fa-user" aria-hidden="true"></i> <span>My Profile</span></a>
                                    {% endif %}  
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ***** Navbar Area ***** -->
        <div class="alazea-main-menu">
            <div class="classy-nav-container breakpoint-off">
                <div class="container">
                    <!-- Menu -->
                    <nav class="classy-navbar justify-content-between" id="alazeaNav">

                        <!-- Nav Brand -->
                        <a href="index.html" class="nav-brand"><img src="/static/alazea-gh-pages/img/core-img/logo3.png" height="300" width="300" alt=""></a>

                        <!-- Navbar Toggler -->
                        <div class="classy-navbar-toggler">
                            <span class="navbarToggler"><span></span><span></span><span></span></span>
                        </div>

                        <!-- Menu -->
                        <div class="classy-menu">

                            <!-- Close Button -->
                            <div class="classycloseIcon">
                                <div class="cross-wrap"><span class="top"></span><span class="bottom"></span></div>
                            </div>

                            <!-- Navbar Start -->
                            <div class="classynav">
                                <ul>
                                    <li><a href="{% url 'welcome' %}">Home</a></li>
                                    <li><a href="{% url 'about' %}">About</a></li>
                                    <li><a href="">Pages</a>
                                        <ul class="dropdown">
                                            <li><a href="{% url 'welcome' %}">Home</a></li>
                                            <li><a href="{% url 'about' %}">About</a></li>
                                            <li><a href="{% url 'productlist' %}">Shop</a>
                                                <ul class="dropdown">
                                                    <li><a href="{% url 'productlist' %}">Shop</a></li>
                                                    <li><a href="{% url 'productlist' %}">Shop Details</a></li>
                                                    <li><a href="{% url 'cart:carts' %}">Shopping Cart</a></li>
                                                    <li><a href="">Checkout</a></li>
                                                </ul>
                                            </li>
                                           
                                           
                                            <li><a href="{% url 'getintouch' %}">Contact</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="{% url 'productlist' %}">Shop</a></li>
                                    <li><a href="{% url 'getintouch' %}">Contact</a></li>
                                </ul>

                                <!-- Search Icon -->
                                <div id="searchIcon">
                                    <i class="fa fa-search" aria-hidden="true"></i>
                                </div>

                            </div>
                            <!-- Navbar End -->
                        </div>
                    </nav>

                    <!-- Search Form -->
                    <div class="search-form">
                        <form action="#" method="get">
                            <input type="search" name="search" id="search" placeholder="Type keywords &amp; press enter...">
                            <button type="submit" class="d-none"></button>
                        </form>
                        <!-- Close Icon -->
                        <div class="closeIcon"><i class="fa fa-times" aria-hidden="true"></i></div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- ##### Header Area End ##### -->

    <!-- ##### Breadcrumb Area Start ##### -->
    <div class="breadcrumb-area">
        <!-- Top Breadcrumb Area -->
        <div class="top-breadcrumb-area bg-img bg-overlay d-flex align-items-center justify-content-center" style="background-image: url(/static/alazea-gh-pages/img/bg-img/24.jpg);">
            <h2>Cart</h2>
        </div>

        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#"><i class="fa fa-home"></i> Home</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Cart</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <!-- ##### Breadcrumb Area End ##### -->
    {% if cart_items %}
    <!-- ##### Cart Area Start ##### -->
    <div class="cart-area section-padding-0-100 clearfix">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="cart-table clearfix">
                        <table class="table table-responsive">
                            <thead>
                                <tr>
                                    <th>Products</th>
                                    <th>Quantity</th>
                                    <th>Price</th>
                                    <th>TOTAL</th>
                                    <th></th>
                                </tr>
                            </thead>
                            {% for item in cart_items %}
                           
                            <tbody>
                                
                                <tr>
                                    <td class="cart_product_img">
                                        <a href="#"><img src="{{item.product_size.product_photo.url}}" alt="Product"></a>
                                        <h5>{{item.product.product_name}}    ({{item.product_size.size}})</h5>
                            
                                    </td>
                                    <td class="qty">
                                        <div class="quantity">
                                            <form action="{% url 'cart:update_cart_item' item.id %}" method="post">
                                                {% csrf_token %}
                                                <div class="quantity">
                                                    <span class="qty-minus" onclick="changeQuantity('{{ item.id }}', -1, this.parentNode )"><i class="fa fa-minus" aria-hidden="true"></i></span>
                                                    <input type="number" class="qty-text" id="qty-{{ item.id }}" step="1" min="1" max="1200" name="quantity" value="{{ item.quantity }}" onchange="updateCartItem('{{ item.id }}', this.value)">
                                                    <input type="text" class="qty-max" id="mj-{{ item.id }}" value="{{ item.product_size.quantity }}" hidden>
                                                    <span class="qty-plus" onclick="changeQuantity('{{ item.id }}', 1, this.parentNode)"><i class="fa fa-plus" aria-hidden="true"></i></span>
                                              
                                                </div>
                                            </form>
                                        </div>  
                                        <p id="error-message-{{ item.id }}" class="error-message text-danger"></p>
                                    </td>  
                                        <script>
                                            
                                            function changeQuantity(itemId, change, parent) {
                                                var quantityInput = parent.querySelector('.qty-text');
                                                var quantity = parseInt(quantityInput.value);
                                                var ma = parseInt(document.getElementById('mj-' + itemId).value);
                                                var err = document.getElementById('error-message-' + itemId).textContent;
                                                console.log("total-------", ma);
                                              
                                                if (!isNaN(quantity)) {
                                                  console.log(change);
                                              
                                                  if (change === -1) {
                                                    clearErrorMessage(itemId);
                                                    if (quantity === 2 && err !== "") {
                                                      quantity = 1;
                                                     
                                                    } else if (quantity > 1) {
                                                      quantity += change;
                                                    }
                                                  } else {
                                                    if (quantity < ma) {
                                                      quantity += change;
                                                    } else {
                                                      displayErrorMessage(itemId, "Quantity exceeds available stock");
                                                    }
                                                  }
                                              
                                                  console.log("negative", quantity);
                                              
                                                  if (quantity >= 1) {
                                                    quantityInput.value = quantity;
                                              
                                                    // Prevent form submission
                                                    event.preventDefault();
                                              
                                                    // Send AJAX request to update the cart item
                                                    updateCartItem(itemId, quantity);
                                                  } else {
                                                    console.log("error detected");
                                                  }
                                                }
                                              }
                                              
                                              function displayErrorMessage(itemId, message) {
                                                console.log("display error");
                                                var errorMessage = document.getElementById('error-message-' + itemId);
                                                errorMessage.textContent = message;
                                              }
                                              
                                              function clearErrorMessage(itemId) {
                                                var errorMessage = document.getElementById('error-message-' + itemId);
                                                errorMessage.textContent = "";
                                              }
                                              
                                            
                                            function  updateCartItem(itemId, quantity) {
                                                var url = "{% url 'cart:update_cart_item' 0 %}".replace('0', itemId);
                                                var csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                                              
                                                $.ajax({
                                                    url: url,
                                                    method: 'POST',
                                                    headers: {
                                                        'X-CSRFToken': csrftoken
                                                    },
                                                    data: {
                                                        
                                                        id: itemId,
                                                        quantity: quantity
                                                    },
                                                    success:function(response) {
                                                        if (response) {
                                                            // Update the subtotal value
                                                            console.log("subtotal",response)
                                                            $('#subtotal-' + itemId).text(response.subtotal);
                                                            $('#total-price').text(response.price)
                                                            $('#total-quty').text(response.quantity)
                                                        } else {
                                                            // Display error message if necessary
                                                            console.log("errror",response.error);
                                                        }
                                                    },
                                                    error: function(xhr, status, error) {
                                                        console.log(error);
                                                    }
                                                }); 
                                            }

                                        </script>      
                                    </td>
                                    <td class="price"><span>{{ item.product_size.price }}</span></td>
                                    <td class="total_price">
                                        <span id="subtotal-{{ item.id }}" class="subtotal-value">{{ item.get_subtotal }}</span>
                                    </td>
                                    <td class="action">
                                        <a href="{% url 'cart:delete_cart_item' item.id %}">
                                            <i class="icon_close"></i>
                                        </a>
                                    </td>
                                    </tr>
                            </tbody>
                            {% endfor %}

                        </table>
                    </div>
                </div>
            </div>

            <div class="row">

                <!-- Coupon Discount -->
                <div class="col-12 col-lg-6">
                    <div class="coupon-discount mt-70">
                        <h5 style="display: inline;">COUPON DISCOUNT</h5> 
                        <!-- <button class="btn btn -success ml-5" style="background-color: rgb(103, 243, 136);" type="submit" data-bs-toggle="modal" data-bs-target="#exampleModal">AVAILABLE COUPON</button> -->
                        <p>Coupons can be applied in the cart prior to checkout. Add an eligible item from the booth of the seller that created the coupon code to your cart. Click the green "Apply code" button to add the coupon to your order. The order total will update to indicate the savings specific to the coupon code entered.</p>
                        <form action="{%  url 'cart:apply_coupon' %}" method="post">
                            {% csrf_token %}
                            <input type="text" name="coupon-code" placeholder="Enter your coupon code">
                            <button type="submit">APPLY COUPON</button>
                        </form>
                    </div>
                </div>
                
            <!-- modal start here -->
            <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel">Available Coupons</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      

                        
                        <div class="card mb-3" style="max-width: 540px;">
                            <div class="row g-0">
                              <div class="col-md-4">
                                <img src="..." class="img-fluid rounded-start" alt="...">
                              </div>
                              <div class="col-md-8">
                                <div class="card-body">
                                  <h5 class="card-title">Card title</h5>
                                  <p class="card-text">This is a wider card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>
                                  <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>
                                </div>
                              </div>
                            </div>
                          </div>
                    </div>
                  </div>
                </div>
              </div>

            <!-- modal end here -->

                <!-- Cart Totals -->
                <div class="col-12 col-lg-6">
                    <div class="cart-totals-area mt-70">
                        <h5 class="title--">Cart Total</h5>
                        <div class="subtotal d-flex justify-content-between">
                            <h5>Total quantity</h5>
                            <h5 id="total-quty">{{cart.get_total_quantity}}</h5>
                        </div>
                        <div class="total d-flex justify-content-between">
                            <h5>Total price</h5>
                            <h5 id="total-price">{{cart.get_total_price}}</h5>
                        </div>
                        <div class="checkout-btn">
                            <a href="{% url 'checkout:checkout' %}" class="btn alazea-btn w-100" style="background-color: rgb(103, 243, 136);" type="submit">PROCEED TO CHECKOUT</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <!-- ##### Cart Area End ##### -->
    {% else %}
    <!-- emptycart starts -->
    <div class="container-fluid  ">
        <div class="row">
        
               <div class="card-body cart">
                       <div class="col-sm-12 empty-cart-cls text-center">
                           <img src="https://i.imgur.com/dCdflKN.png" width="130" height="130" class="img-fluid mb-4 mr-3">
                           <h3><strong>Your Cart is Empty</strong></h3>
                           <h4>Add something in your cart :)</h4>
                           <a href="{% url 'productlist' %}" class="btn btn-primary cart-btn-transform m-3" data-abc="true">continue shopping</a>
                       </div>
               </div>
       </div>
               
           
           </div>
    <!-- emptycart ends -->
    {% endif %}
    <!-- ##### Footer Area Start ##### -->
    <footer class="footer-area bg-img" style="background-image: url(/static/alazea-gh-pages/img/bg-img/3.jpg);">
        <!-- Main Footer Area -->
        <div class="main-footer-area">
            <div class="container">
                <div class="row">

                    <!-- Single Footer Widget -->
                    <div class="col-12 col-sm-6 col-lg-3">
                        <div class="single-footer-widget">
                            <div class="footer-logo mb-30">
                                <a href="#"><img src="/static/alazea-gh-pages/img/core-img/logo3.png" alt=""></a>
                            </div>
                        </div>
                    </div>

                    <!-- Single Footer Widget -->
                    <div class="col-12 col-sm-6 col-lg-3">
                        <div class="single-footer-widget">
                            <div class="widget-title">
                                <h5>QUICK LINK</h5>
                            </div>
                            <nav class="widget-nav">
                                <ul>
                                    <li><a href="#">Purchase</a></li>
                                    <li><a href="#">FAQs</a></li>
                                    <li><a href="#">Payment</a></li>
                                    <li><a href="">News</a></li>
                                    <li><a href="#">Return</a></li>
                                    <li><a href="#">Advertise</a></li>
                                    <li><a href="#">Shipping</a></li>
                                    <li><a href="#">Career</a></li>
                                    <li><a href="#">Orders</a></li>
                                    <li><a href="#">Policities</a></li>
                                </ul>
                            </nav>
                        </div>
                    </div>

                    
                    <!-- Single Footer Widget -->
                    <div class="col-12 col-sm-6 col-lg-3">
                        <div class="single-footer-widget">
                            <div class="widget-title">
                                <h5>CONTACT</h5>
                            </div>

                            <div class="contact-information">
                                <p><span>Address:</span>MAIN ROAD CHALAKUDY</p>
                                <p><span>Phone:</span> +1 234 122 122</p>
                                <p><span>Email:</span> info.verdure@gmail.com</p>
                                <p><span>Open hours:</span> Mon - Saturday: 8 AM to 9 PM</p>
                                <p><span>Happy hours:</span> Sat: 2 PM to 4 PM</p>
                            </div>
                        </div>
                    </div>
        
                    <div class="col-12 col-sm-6 col-lg-3 mt-5">
                    <div class="single-footer-widget mt-5">
                        <div class="social-info">
                            <a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a>
                            <a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a>
                            <a href="#"><i class="fa fa-google-plus" aria-hidden="true"></i></a>
                            <a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a>
                            <a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>

        <!-- Footer Bottom Area -->
        <div class="footer-bottom-area">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="border-line"></div>
                    </div>
                    <!-- Copywrite Text -->
                    <div class="col-12 col-md-6">
                        <div class="copywrite-text">
                            <p>&copy; <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved 
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
</p>
                        </div>
                    </div>
                    <!-- Footer Nav -->
                    <div class="col-12 col-md-6">
                        <div class="footer-nav">
                            <nav>
                                <ul>
                                    <li><a href="#">Home</a></li>
                                    <li><a href="#">About</a></li>
                                    <li><a href="#">Shop</a></li>
                                    <li><a href="#">Contact</a></li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- ##### Footer Area End ##### -->


    <!-- ##### All Javascript Files ##### -->
    <!-- jQuery-2.2.4 js -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.15.5/dist/sweetalert2.all.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.0/js/bootstrap.bundle.min.js"></script>


    <script src="/static/alazea-gh-pages/js/jquery/jquery-2.2.4.min.js"></script>
    <!-- Popper js -->
    <script src="/static/alazea-gh-pages/js/bootstrap/popper.min.js"></script>
    <!-- Bootstrap js -->
    <script src="/static/alazea-gh-pages/js/bootstrap/bootstrap.min.js"></script>
    <!-- All Plugins js -->
    <script src="/static/alazea-gh-pages/js/plugins/plugins.js"></script>
    <!-- Active js -->
    <script src="/static/alazea-gh-pages/js/active.js"></script>
    {% for message in messages %}
    <script>
        Swal.fire({
            icon: "{{ message.tags }}",
            title: "{{ message }}",
            showConfirmButton: false,
            timer: 3000 // Adjust the duration as needed
        });
    </script>
{% endfor %}
</body>

</html>